# -*- coding: utf-8 -*-
"""mr.ipynb

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/1vr4dCZf-hv1xeH88MUZOSKFIe6cf_L6k
"""

import streamlit as st
import pandas as pd
from datetime import datetime
import os

# =============================
# Configuraci√≥n de la p√°gina
# =============================
st.set_page_config(
    page_title="Pedidos ‚Äì Marisquer√≠a Ram√≠rez",
    page_icon="ü¶ê",
    layout="centered"
)

# =============================
# Encabezado
# =============================
st.title("ü¶ê Marisquer√≠a Ram√≠rez")
st.subheader("Sistema de pedidos de insumos")

# Imagen local
st.image(
    "mr.jpeg",
    caption="Marisquer√≠a Ram√≠rez",
    use_container_width=True,width=100
)

st.divider()

# =============================
# Cat√°logo de productos
# =============================
catalogo = [
    # -------- SAMS --------
    {"Familia": "SAMS", "Producto": "CLORO", "Especificaci√≥n": "10 LITROS"},
    {"Familia": "SAMS", "Producto": "FABULOSO (LAVANDA)", "Especificaci√≥n": "10 LITROS"},
    {"Familia": "SAMS", "Producto": "ARROZ VALLE VERDE", "Especificaci√≥n": "5 PZAS. 1 KG"},
    {"Familia": "SAMS", "Producto": "FRIJO VALLE VERDE (FLOR DE MAYO)", "Especificaci√≥n": "2.5 KG"},
    {"Familia": "SAMS", "Producto": "FRIJO VALLE VERDE (NEGRO)", "Especificaci√≥n": "2.5 KG"},
    {"Familia": "SAMS", "Producto": "ACEITE 1-2-3", "Especificaci√≥n": "PAQUETE 3 LITROS"},
    {"Familia": "SAMS", "Producto": "VALENTINA ROJA", "Especificaci√≥n": "350 ML (6 PZAS)"},
    {"Familia": "SAMS", "Producto": "VALENTINA ROJA", "Especificaci√≥n": "4 LITROS (1 PZA)"},

    # -------- MATERIA PRIMA --------
    {"Familia": "MATERIA PRIMA", "Producto": "CHAROLA 835", "Especificaci√≥n": "FILETES"},
    {"Familia": "MATERIA PRIMA", "Producto": "CHAROLA 855", "Especificaci√≥n": "PEDIDOS GRANDES"},
    {"Familia": "MATERIA PRIMA", "Producto": "CHAROLA 066", "Especificaci√≥n": "PEDIDOS MEDIANOS"},
    {"Familia": "MATERIA PRIMA", "Producto": "BOLSA CHICA (1)", "Especificaci√≥n": "PEDIDOS CHICOS"},
    {"Familia": "MATERIA PRIMA", "Producto": "BOLSA (2)", "Especificaci√≥n": "PEDIDOS GRANDES"},

    # -------- SALSAS --------
    {"Familia": "SALSAS", "Producto": "VALENTINA NEGRA", "Especificaci√≥n": "350 ML"},
    {"Familia": "SALSAS", "Producto": "VALENTINA AZUL", "Especificaci√≥n": "350 ML"},
]

df = pd.DataFrame(catalogo)

# =============================
# Realizar pedido
# =============================
st.header("üõí Realizar pedido")

pedido = []

for familia in df["Familia"].unique():
    st.subheader(f"üì¶ {familia}")
    productos = df[df["Familia"] == familia]

    for _, row in productos.iterrows():
        col1, col2 = st.columns([3, 1])

        with col1:
            st.write(f"**{row['Producto']}** ‚Äì {row['Especificaci√≥n']}")

        with col2:
            cantidad = st.number_input(
                "Cantidad",
                min_value=0,
                step=1,
                key=f"{row['Producto']}_{row['Especificaci√≥n']}"
            )

        if cantidad > 0:
            pedido.append({
                "Familia": familia,
                "Producto": row["Producto"],
                "Especificaci√≥n": row["Especificaci√≥n"],
                "Cantidad": cantidad
            })

# =============================
# Resumen y guardado
# =============================
st.divider()
st.header("üìã Resumen del pedido")

if pedido:
    df_pedido = pd.DataFrame(pedido)
    st.dataframe(df_pedido, use_container_width=True)

    # Guardar CSV
    fecha = datetime.now().strftime("%Y%m%d_%H%M%S")
    nombre_archivo = f"pedido_marisqueria_{fecha}.csv"

    if st.button("üíæ Guardar pedido en CSV"):
        df_pedido["Fecha"] = datetime.now().strftime("%Y-%m-%d")
        df_pedido["Hora"] = datetime.now().strftime("%H:%M:%S")

        df_pedido.to_csv(nombre_archivo, index=False, encoding="utf-8-sig")

        st.success(f"Pedido guardado correctamente como `{nombre_archivo}` ‚úÖ")

        # Descargar desde Streamlit
        with open(nombre_archivo, "rb") as file:
            st.download_button(
                label="‚¨áÔ∏è Descargar pedido",
                data=file,
                file_name=nombre_archivo,
                mime="text/csv"
            )

else:
    st.info("A√∫n no has agregado productos al pedido.")
